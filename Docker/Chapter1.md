시작하세요! 도커 / 쿠버네티스 

# 01. 도커란?

도커는 *리눅스 컨테이너*에 여러 기능을 추가함으로써 애플리케이션을 컨테이너로서 좀 더 쉽게 사용할 수 있게 만들어진 오픈소스 프로젝트입니다. 도커는 Go 언어로 작성되어 있으며, 꾸준히 개발되고 있다.

---

#### 리눅스 컨테이너란? 
출처 : https://loopstudy.tistory.com/20

어떤 개발자가 개인 노트북에서 애플리케이션을 만들었다.
노트북에선 잘 동작을 하지만 개발서버, 운영서버 같은 <u>환경이 다른곳에서 실행이 되면 똑같이 실행이 될까?</u>
다양한 환경때문에 개인 노트북에서는 마주치지 못한 다양한 상황이 발생할 것이다 그래서 환경이 변해도 안정적으로 실행하기 위한 방법으로 컨테이너가 나오게 되었다.

컨테이너 개념은 간단하다.
애플리케이션과 그 실행에 필요한 라이브러리, 바이너리, 구성 파일등을 패키지 단위로 묶어 배포하는 것으로 운영환경이 변해도 실행에 필요한 파일이 함께 따라다니므로 오류를 최소화할 수 있다.
운영체제를 제외하고 실행에 필요한 모든 파일을 패키징한다는 점에서 운영체제 위에서 구현된 가상화
즉 **'운영체제 레벨 가상화'** 라고 부른다

리눅스 컨테이너는 운영체제 수준의 가상화 기술로 리눅스 커널을 공유하면서 프로세스를 격리된 환경에서 실행하는 기술이다.
 
<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2F8ytz4%2FbtqXRuRIxRi%2FfGvA8PXkSmaiqQlWffRCT0%2Fimg.png" />

하드웨어를 가상화하는 가상 머신은 자체 OS를 포함하고 있어서 일반적으로 GB 단위를 가진다.
컨테이너는 애플리케이션이 실행되는데 필요한 요소만 패키징이 되어 MB 단위로 경량화 되어있다.
 
가상머신은 인프라와 시스템 관리자가 효율성을 높이려고 수행했던 업무에 중점이고,
컨테이너는 애플리케이션 개발자에 초점을 맞추고 애플리케이션을 제어하기 위해 경량화 된 방법을 사용하여 프로세스 그 자체다.

##### 리눅스 컨테이너의 주요 특징

- 운영체제 수준의 가상화 : 컨테이너는 운영체제 수준의 가상화로 가상머신처럼 하드웨어 에뮬레이션 없이 리눅스 커널을 공유해 컨테이너를 실행하며, 게스트OS 관리가 필요하지 않다.
빠른 속도와 효율성 : 하드웨어 에뮬레이션이 없어 빠르게 실행된다. 하나의 머신에서 프로세스만큼 많이 실행하는 것이 가능하다.
- 높은 이식성(portability) : 컨테이너는 호스트 환경이 아닌 독자적인 실행 환경을 가지고 있다. 이 환경은 파일들로 구성되며, 이미지 형식으로 공유될 수 있다. 리눅스 커널을 사용하고 같은 컨테이너 런타임을 사용할 경우 컨테이너의 실행 환경을 공유하고 손쉽게 재현할 수 있다
- 상태를 가지지 않는다(stateless) : 컨테이너가 실행되는 환경은 독립적이라 다른 컨테이너에게 영향을 주지 않는다. 도커같은 이미지 기반으로 컨테이너 사용하는 경우 특정 실행 환경을 쉽게 재사용가능하다

컨테이너는 네임스페이스, 컨트롤 그룹, 루트 디렉터리 격리, 캐퍼빌리티, 유니온 마운트 등 다양한 리눅스 커널의 기능들이 사용된다.

---
도커와 관련된 프로젝트는 도커 컴포즈, 레지스트리, 도커 허브 등 여러 가지가 있지만 일반적으로 도커라고 하면 **도커 엔진** 혹은 도커에 관련된 모든 프로젝트를 의미합니다.

도커 엔진은 컨테이너를 생성하고 관리하는 주체로서, 이 자체로도 컨테이너를 제어할 수 있고 다양한 기능을 제공하는 도커의 주 프로젝트이다.

이번 장에서는 도커 컨테이너를 다루기 위한 가장 기본적인 프로젝트인 도커 엔진을 사용하는 방법을 다룬다!

## 1.1 가상 머신과 도커 컨테이너

### 가상 머신

기존의 가상화 기술은 하이퍼바이저(*)를 이용해 여러 개의 운영체제를 하나의 호스트에서 생성해 사용하는 방식이다. 이러한 여러 개의 운영체제는 **가상 머신** 이라는 당ㄴ위로 구별되고, 각 가상머신에는 우분투, centOS 등의 운영체제가 설치되어 사용된다. 

- 게스트 운영체제(Guest OS) : 하이퍼바이저에 의해 생성되고 관리되는 운영체제, 각 게스트 운영체제는 다른 게스트 운영체제와는 완전히 독립된 공간과 시스템 자원을 할당받아 사용한다.
- 대표적인 가상화 툴 : Virtual Box, VMware 등

- 장점 
    1. 게스트 운영체제를 사용하기 위한, 라이브러리, 커널 등을 전부 포함하여 완벽한 운영체제를 생성할 수 있다.
- **단점** 
    1. 전부 포함하기 때문에 가상 머신을 배포하기 위한 이미지로 만들었을 때 이미지의 크기 또한 커진다. 수 기가바이트에 달하는 이미지를 애플리케이션으로 배포하기는 부담스럽다. 
    2. 각종 시스템 자원을 가상화하고 독립된 공간을 생성하는 작업은 하이퍼바이저를 반드시 거치기 때문에 일반 호스트에 비해 성능의 손실이 발생한다.
    
    
##### 하이퍼바이저
하이퍼바이저는 가상 머신(Virtual Machine, VM)을 생성하고 구동하는 소프트웨어입니다. 가상 머신 모니터(Virtual Machine Monitor, VMM)라고도 불리는 하이퍼바이저는 하이퍼바이저 운영 체제와 가상 머신의 리소스를 분리해 VM의 생성과 관리를 지원합니다.

--- 


### 도커 컨테이너
- 장점
    1. 가상화된 공간을 생성하기 위해 리눅스의 자체 기능(*)인 chroot, namespace, cgroup을 사용함으로써 프로세스 단위의 격리 환경을 만들기 때문에 성능 손실이 거의 없다.
    2. 컨테이너에 필요한 커널은 호스트의 커널을 공유해 사용하고, 컨테이너 안에는 애플리케이션을 구동하는데 필요한 라이브러리 및 실행 파일만 존재하기 때문에 컨테이너를 이미지로 만들었을 때 이미지의 용량 또한 가상머신에 비해 대폭 줄어든다. -> 배포하는 시간도 빠르다!

##### 리눅스 명령어 (chroot, namespace, cgroup)
출처 : https://tomatohj.tistory.com/39

**chroot** 
- 프로세스에 대하여 새로운 root 디렉토리를 지정하는 것 (가상루트디렉토리)
- 새로운 root 디렉토리가 지정된 프로세스는 할당된 root 디렉토리 하위로만 접근이 가능함
- 즉 프로세스에 대한 파일시스템 격리 (다만 시스템 설정 및 환경은 동일함)
- 참고자료 : man7.org/linux/man-pages/man1/chroot.2.html

**namespace**
- 프로세스 별 리소스 사용을 분리하는 것
- namespace 말 그대로 이름이 다른 공간을 만들어, 프로세스를 분리함
- 다른 namespace에 존재하는 프로세스들은 서로 리소스 관리를 따로 수행 ex) namespace a에서 동작하는 aa 프로세스에서 hostname을 test로 변경한다고 해도, namespace b에서 동작하는 bb 프로세스의 hostname은 변하지 않음
- 즉 프로세스에 대한 환경 격리 (다만 하드웨어 자원에 대한 분리를 수행하지는 않음)
- 참고자료 : man7.org/linux/man-pages/man7/namespaces.7.html

**cgroup**
- 프로세스 별 가용 컴퓨팅 자원(메모리,  cpu, device, device, disk I/o)을 제어하는 것
- 참고자료 : man7.org/linux/man-pages/man7/cgroups.7.html

## 1.2 도커를 시작해야 하는 이유

컨테이너는 OpenVZ, LXC, cri-o 등 몇 가지가 존재하지만, 특히 그 중에서도 <u>도커는 컨테이너 생테계에서 사실상 표준으로서 사용되고 있다.</u>

### 1.2.1 애플리케이션의 개발과 배포가 편해집니다.

도커 컨테이너는 호스트 OS 위에서 실행되는 격리된 공간이다. 따라서 컨테이너 자체에 특별한 권한을 주지 않는 한, 컨테이너 내부에서 수많은 소프트웨어를 설치하고 설정 파일을 수정해도 호스트 OS에는 영향을 끼치지 않습니다. 즉, <u>독립된 개발환경을 보장받을 수 있다.</u>

컨테이너 내부에서 작업을 마친 뒤 운영 환경에 배포하려고 한다면, 해당 컨테이너를 `도커 이미지` 라고 하는 일종의 패키지로 만들어 운영 서버에 전달하면 된다. 운영 서버에서 새롭게 패키지를 설치할 필요도 없으며, 라이브러리 등으로 인한 의존성을 걱정할 필요도 없다. <u>서비스를 개발했을 대 사용했던 환경을 다른 서버에서도 컨테이너로서 똑같이 복제할 수 있기 때문에 개발/운영 환경의 통합이 가능해진다.
</u>

도커 이미지는 가상 머신의 이미지와 달리 커널을 포함하고 있지 않기 때문에, 이미지 크기가 크지 않다. 또한 도커는 이미지 내용을 **레이어 단위**로 구성하며, 중복되는 레이어를 재사용할 수 있어서 <u>애플리케이션의 배포 속도가 매우 빨라진다는 장점이 있다.</u>

### 1.2.2 여러 애플리케이션이 독립성과 확장성이 높아집니다.

모놀리스(monolith) 애플리케이션
- 소프트웨어의 여러 모듈이 상호 작용하는 로직을 하나의 프로그램 내에서 구동시키는 방식
- 단점 : 서비스의 기능이 복잡하고 거대해질 수록 소프트웨어 자체의 확장성과 유연성이 줄어든다.

-> 모놀리스 방식을 대체하기 위해 새롭게 떠오른 개념이 `마이크로서비스(Microservices)` 구조이다.

마이크로서비스(Microservices) 구조
- 여러 모듈을 독립된 형태로 구성하기 때문에 언어에 종속되지 않고 변화에 빠르게 대응할 수 있다.
- 각 모듈의 관리가 쉬워진다.
- 컨테이너는 수 초 내로 생성, 시작이 가능하고 여러 모듈에게 독립된 환경을 동시에 제공할 수 있다.
